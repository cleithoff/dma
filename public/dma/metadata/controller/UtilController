{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "UtilController"
    },
    "designerId": "4ead814c-fb54-4753-940d-1367a7b38d21",
    "cn": [
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "assignReportsToPrintButton",
                "designer|params": [
                    "button",
                    "component"
                ],
                "implHandler": [
                    "\r",
                    "var storeUserResource = Ext.getStore('UserResourceJsonStore');\r",
                    "\r",
                    "storeUserResource.clearFilter(true);\r",
                    "storeUserResource.filter([{property:'slug',value:component.itemId}]);\r",
                    "storeUserResource.load({\r",
                    "    callback: function(records, operation, success) {\r",
                    "        if (records.length > 0) {\r",
                    "            \r",
                    "            var storeUserResourceHasReportReport = Ext.getStore('UserResourceHasReportReportJsonStore');\r",
                    "            \r",
                    "            storeUserResourceHasReportReport.clearFilter(true);\r",
                    "            storeUserResourceHasReportReport.filter([{property:'user_resource_id',value:records[0].data.id}]);\r",
                    "            storeUserResourceHasReportReport.load({\r",
                    "                callback: function(records, operation, success) {\r",
                    "                    if (records.length > 0) {\r",
                    "                        \r",
                    "                        var items = [];\r",
                    "                        \r",
                    "                        for (var idx in records) {\r",
                    "                            items.push({\r",
                    "                                xtype: 'menuitem',\r",
                    "                                text: records[idx].data.report_report.title,\r",
                    "                                record: records[idx],\r",
                    "                                printButton: button,\r",
                    "                                handler: function(item, e, eOpts) {\r",
                    "                                    console.log(item.record);\r",
                    "                                    MyApp.app.getUtilControllerController().showFilterDialog(item);\r",
                    "                                }\r",
                    "                            });\r",
                    "                        }\r",
                    "                        \r",
                    "                        button.menu = Ext.create('Ext.menu.Menu', {\r",
                    "                            items: items\r",
                    "                        });\r",
                    "                        \r",
                    "                    }\r",
                    "                }\r",
                    "            });\r",
                    "        }\r",
                    "    }\r",
                    "});\r",
                    "\r",
                    "\r",
                    "/*\r",
                    "button.menu = Ext.create('Ext.menu.Menu', {\r",
                    "            items: [\r",
                    "                {\r",
                    "                    xtype: 'menuitem',\r",
                    "                    itemId: 'PartnerMenuItem',\r",
                    "                    text: 'Partner'\r",
                    "                },\r",
                    "                {\r",
                    "                    xtype: 'menuitem',\r",
                    "                    itemId: 'OrderMenuItem',\r",
                    "                    text: 'Bestellungen'\r",
                    "                },\r",
                    "                {\r",
                    "                    xtype: 'menuitem',\r",
                    "                    itemId: 'ReportMenuItem',\r",
                    "                    text: 'Reporte'\r",
                    "                },\r",
                    "                {\r",
                    "                    xtype: 'menuitem',\r",
                    "                    itemId: 'ImportMenuItem',\r",
                    "                    text: 'Import'\r",
                    "                }\r",
                    "            ]\r",
                    "        });\r",
                    "\r",
                    "*/"
                ]
            },
            "designerId": "64caf03c-018c-4a14-8e61-37deb85b0fd2"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "showFilterDialog",
                "designer|params": [
                    "item"
                ],
                "implHandler": [
                    "var \r",
                    "report_report = item.record.data.report_report,\r",
                    "user_resource = item.printButton.up('#' + item.record.data.user_resource.slug),\r",
                    "record = user_resource.down('gridpanel').getSelectionModel().getSelection()[0];\r",
                    "\r",
                    "\r",
                    "\r",
                    "var store = Ext.getStore('ReportFilterJsonStore');\r",
                    "store.clearFilter(true);\r",
                    "store.filter([{property:\"report_report_id\",value:report_report.id}]);\r",
                    "store.load({\r",
                    "    callback: function(records,operation,success) {\r",
                    "        fields = MyApp.app.getUtilControllerController().getReportFilter(records,record);\r",
                    "\r",
                    "        if (fields.length === 0) {\r",
                    "            var _dc = new Date().getTime();\r",
                    "            document.location = \"/report/report/exportpdf?_dc=\" + _dc + \"&report_report_id=\" + report_report.id;\r",
                    "            return;\r",
                    "        }\r",
                    "\r",
                    "        var window = Ext.create('Ext.window.Window', {\r",
                    "            title: 'Drucken - ' + report_report.title,\r",
                    "            layout: 'fit',\r",
                    "            items: [\r",
                    "            {\r",
                    "                xtype: 'form',\r",
                    "                itemId: 'FormPanel',\r",
                    "                bodyPadding: 10,\r",
                    "                header: false,\r",
                    "                title: 'My Form',\r",
                    "                items:fields,\r",
                    "                dockedItems: [\r",
                    "                {\r",
                    "                    xtype: 'toolbar',\r",
                    "                    dock: 'bottom',\r",
                    "                    items: [\r",
                    "                    {\r",
                    "                        xtype: 'button',\r",
                    "                        handler: function(button, event) {\r",
                    "                            var me = button.up('window');\r",
                    "\r",
                    "                            me.close();\r",
                    "                        },\r",
                    "                        itemId: 'CancelButton',\r",
                    "                        text: 'Abbrechen'\r",
                    "                    },\r",
                    "                    {\r",
                    "                        xtype: 'tbspacer',\r",
                    "                        flex: 1\r",
                    "                    },\r",
                    "                    {\r",
                    "                        xtype: 'button',\r",
                    "                        handler: function(button, event) {\r",
                    "                            var me = button.up('window');\r",
                    "\r",
                    "\r",
                    "                            var _dc = new Date().getTime();\r",
                    "\r",
                    "                            filterFormPanel = me.down('form');\r",
                    "\r",
                    "                            params = filterFormPanel.getValues();\r",
                    "\r",
                    "                            strParams = '';\r",
                    "\r",
                    "                            for (var idx in params) {\r",
                    "                                strParams = strParams + '&' + idx + '=' + params[idx];\r",
                    "                            }\r",
                    "\r",
                    "                            document.location = \"/report/report/export\" + report_report.default_export + \"?_dc=\" + _dc + \"&report_report_id=\" + report_report.id + strParams;\r",
                    "\r",
                    "\r",
                    "                            me.close();\r",
                    "                        },\r",
                    "                        itemId: 'OkButton',\r",
                    "                        text: 'Drucken'\r",
                    "                    }\r",
                    "                    ]\r",
                    "                }\r",
                    "                ]\r",
                    "            }\r",
                    "            ]\r",
                    "        }).show();\r",
                    "\r",
                    "    }\r",
                    "});\r",
                    "\r",
                    ""
                ]
            },
            "designerId": "034489b5-df30-4b76-a34c-bf093afeec9e"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "getReportFilter",
                "designer|params": [
                    "records",
                    "recordFilterValues"
                ],
                "implHandler": [
                    "var fields = [];\r",
                    "\r",
                    "for(var idx in records) {\r",
                    "    r = records[idx];\r",
                    "    config = JSON.parse(r.data.jsonparam);\r",
                    "    switch(r.data.report_filtertype.key) {\r",
                    "        case 'combobox':\r",
                    "        config.xtype = 'combobox';\r",
                    "        config.triggerAction = 'all';\r",
                    "        config.listeners = {\r",
                    "            render: function() {\r",
                    "                this.store.load({params:{query:this.allQuery}});\r",
                    "            }\r",
                    "        };\r",
                    "        break;\r",
                    "        case 'datetime':\r",
                    "        config.xtype = 'datefield';\r",
                    "        break;\r",
                    "        case 'string':\r",
                    "        config.xtype = 'textfield';\r",
                    "        break;\r",
                    "        case 'integer':\r",
                    "        config.xtype = 'numberfield';\r",
                    "        break;\r",
                    "    }\r",
                    "\r",
                    "    switch(config.name) {\r",
                    "        case 'partner_nr':\r",
                    "        config.value = recordFilterValues.data.partner_partner.partner_nr\r",
                    "        break;\r",
                    "        case 'import_stack_id':\r",
                    "        config.value = recordFilterValues.data.import_stack_id\r",
                    "        break;\r",
                    "    }\r",
                    "    fields.push(config);\r",
                    "}\r",
                    "\r",
                    "return fields;"
                ]
            },
            "designerId": "37a9fadc-ccb4-424b-aba0-926d3d9604c5"
        }
    ]
}